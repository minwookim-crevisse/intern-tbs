<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì±„ì  ëª¨ë“ˆ ë°ëª¨ - TBS í…ŒìŠ¤íŠ¸ ì›¹ì•±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input[type="text"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            display: block;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            display: block;
        }

        .result.loading {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            display: block;
        }

        .result h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .result p {
            margin-bottom: 5px;
            line-height: 1.6;
        }

        .score-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        .login-panel {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .login-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.admin {
            background: #28a745;
            color: white;
        }

        .status-badge.candidate {
            background: #17a2b8;
            color: white;
        }

        .status-badge.guest {
            background: #6c757d;
            color: white;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .info-box p {
            margin: 5px 0;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI ì±„ì  ëª¨ë“ˆ ë°ëª¨</h1>
            <p>OpenRouter API (DeepSeek R1T2 Chimera) ì—°ë™ í…ŒìŠ¤íŠ¸</p>
        </div>

        <div class="content">
            <!-- ë¡œê·¸ì¸ íŒ¨ë„ -->
            <div class="login-panel">
                <div class="login-status">
                    <div>
                        <strong>ë¡œê·¸ì¸ ìƒíƒœ:</strong>
                        <span class="status-badge guest" id="loginStatus">ë¡œê·¸ì•„ì›ƒ</span>
                        <span id="userName"></span>
                    </div>
                    <div class="button-group">
                        <button onclick="quickLogin('admin')" class="btn-success">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
                        <button onclick="quickLogin('jahyun')" class="btn-secondary">í›„ë³´ì ë¡œê·¸ì¸</button>
                        <button onclick="logout()" class="btn-danger">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                </div>
            </div>

            <!-- API í‚¤ ì„¤ì • -->
            <div class="section">
                <h2>1ï¸âƒ£ API í‚¤ ì„¤ì •</h2>
                <div class="form-group">
                    <label for="apiKey">OpenRouter API í‚¤</label>
                    <input type="password" id="apiKey" placeholder="sk-or-v1-...">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ğŸ’¡ .env íŒŒì¼ì˜ í‚¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
                    </small>
                </div>
                <div class="button-group">
                    <button onclick="useEnvKey()">í™˜ê²½ ë³€ìˆ˜ í‚¤ ì‚¬ìš©</button>
                    <button onclick="validateKey()">í‚¤ ê²€ì¦</button>
                    <button onclick="saveKeyToSession()">ì„¸ì…˜ì— ì €ì¥</button>
                </div>
                <div id="keyValidationResult" class="result"></div>
            </div>

            <!-- ì±„ì  í…ŒìŠ¤íŠ¸ -->
            <div class="section">
                <h2>2ï¸âƒ£ AI ì±„ì  í…ŒìŠ¤íŠ¸</h2>

                <div class="form-group">
                    <label for="userId">í›„ë³´ì ID</label>
                    <select id="userId">
                        <option value="jahyun">jahyun (í™ìí˜„)</option>
                        <option value="candidate1">candidate1 (í›„ë³´ì1)</option>
                        <option value="candidate2">candidate2 (í›„ë³´ì2)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="problemId">ë¬¸ì œ ë²ˆí˜¸</label>
                    <select id="problemId">
                        <option value="1">ë¬¸ì œ 1: SaaS ì„œë¹„ìŠ¤ ì‚¬ìš©ë£Œ ì •ì‚° ì˜¤ë¥˜ ê²€ìˆ˜</option>
                        <option value="2">ë¬¸ì œ 2: ë¯¸ë””ì–´ ì‚¬ì—… ì‚¬ìš©ë£Œ ì •ì‚°ì„œ ì‘ì„±</option>
                    </select>
                </div>

                <div class="info-box">
                    <p><strong>âš ï¸ í…ŒìŠ¤íŠ¸ ì „ ì¤€ë¹„ì‚¬í•­:</strong></p>
                    <p>1. ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
                    <p>2. í›„ë³´ìê°€ ë‹µì•ˆì„ ì œì¶œí•œ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤</p>
                    <p>3. API í‚¤ë¥¼ ì…ë ¥í•˜ê³  ê²€ì¦í•˜ì„¸ìš”</p>
                </div>

                <button onclick="performGrading()" style="width: 100%;">
                    ğŸš€ AI ì±„ì  ì‹œì‘
                </button>

                <div id="gradingResult" class="result"></div>
            </div>

            <!-- ì§ì ‘ ë‹µì•ˆ ì…ë ¥ í…ŒìŠ¤íŠ¸ -->
            <div class="section">
                <h2>3ï¸âƒ£ ì§ì ‘ ë‹µì•ˆ ì…ë ¥ í…ŒìŠ¤íŠ¸</h2>

                <div class="form-group">
                    <label for="directProblemId">ë¬¸ì œ ë²ˆí˜¸</label>
                    <select id="directProblemId">
                        <option value="1">ë¬¸ì œ 1</option>
                        <option value="2">ë¬¸ì œ 2</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="directAnswer">í›„ë³´ì ë‹µì•ˆ (í…ìŠ¤íŠ¸)</label>
                    <textarea id="directAnswer" placeholder="ì±„ì í•  ë‹µì•ˆì„ ì…ë ¥í•˜ì„¸ìš”...

ì˜ˆì‹œ:
[ë‹µì•ˆ 1-1]
ì˜¤ë¥˜ ë¶„ì„:
1. ê¸°ë³¸ì„œë¹„ìŠ¤ ì‚¬ìš©ë£Œ: FR-0002 ìƒí’ˆì´ 3ì›”ë¶„ì— ëˆ„ë½ë¨
2. í™•ì¥ì„œë¹„ìŠ¤: DQT-00001 ì¼í•  ê³„ì‚° ì˜¤ë¥˜
3. ë©”ì‹œì§€ ì¶©ì „ê¸ˆ: ì „ì›” ì”ì•¡ ë¯¸ë°˜ì˜

ìˆ˜ì • ë‚´ì—­:
- FR-0002: +50,000ì›
- ë©”ì‹œì§€ ì¶©ì „ê¸ˆ: ì „ì›” ì”ì•¡ ë°˜ì˜
..."></textarea>
                </div>

                <button onclick="performDirectGrading()" style="width: 100%;">
                    ğŸ§ª ì§ì ‘ ì±„ì  í…ŒìŠ¤íŠ¸
                </button>

                <div id="directGradingResult" class="result"></div>
            </div>

            <!-- ë””ë²„ê¹… ì •ë³´ -->
            <div class="section">
                <h2>4ï¸âƒ£ ë””ë²„ê¹… ì •ë³´</h2>
                <div class="button-group">
                    <button onclick="showPrompt()">í”„ë¡¬í”„íŠ¸ í™•ì¸</button>
                    <button onclick="showSubmissions()">ì œì¶œ í˜„í™© í™•ì¸</button>
                    <button onclick="showGrades()">ì±„ì  í˜„í™© í™•ì¸</button>
                    <button onclick="clearStorage()">Storage ì´ˆê¸°í™”</button>
                </div>
                <div id="debugResult" class="result"></div>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="backend.js"></script>
    <script src="ai-grading.js"></script>

    <script>
        // .envì˜ API í‚¤ (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì´ë ‡ê²Œ í•˜ë“œì½”ë”©í•˜ë©´ ì•ˆë¨!)
        const ENV_API_KEY = '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';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        window.addEventListener('DOMContentLoaded', () => {
            updateLoginStatus();

            // ì„¸ì…˜ì— ì €ì¥ëœ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedKey = sessionStorage.getItem('openrouter_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
        });

        // ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateLoginStatus() {
            const user = TBSBackend.auth.getCurrentUser();
            const statusBadge = document.getElementById('loginStatus');
            const userName = document.getElementById('userName');

            if (user) {
                statusBadge.textContent = user.role === 'admin' ? 'ê´€ë¦¬ì' : 'í›„ë³´ì';
                statusBadge.className = 'status-badge ' + user.role;
                userName.textContent = `(${user.name})`;
            } else {
                statusBadge.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                statusBadge.className = 'status-badge guest';
                userName.textContent = '';
            }
        }

        // ë¹ ë¥¸ ë¡œê·¸ì¸
        function quickLogin(userId) {
            const passwords = {
                'admin': 'admin1234',
                'jahyun': 'pass1',
                'candidate1': 'test1234',
                'candidate2': 'test1234'
            };

            const result = TBSBackend.auth.login(userId, passwords[userId]);
            if (result.success) {
                alert(`âœ… ${result.user.name}ë‹˜ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                updateLoginStatus();
            } else {
                alert(`âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${result.message}`);
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            TBSBackend.auth.logout();
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateLoginStatus();
        }

        // í™˜ê²½ ë³€ìˆ˜ í‚¤ ì‚¬ìš©
        function useEnvKey() {
            document.getElementById('apiKey').value = ENV_API_KEY;
            alert('âœ… .env íŒŒì¼ì˜ API í‚¤ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // API í‚¤ ê²€ì¦
        async function validateKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const resultDiv = document.getElementById('keyValidationResult');

            if (!apiKey) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>âŒ ì˜¤ë¥˜</h3><p>API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>';
                return;
            }

            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '<h3>â³ ê²€ì¦ ì¤‘...</h3><p>API í‚¤ ìœ íš¨ì„±ì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>';

            try {
                const isValid = await AIGrading.validateAPIKey(apiKey);

                if (isValid) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = '<h3>âœ… ìœ íš¨í•œ API í‚¤</h3><p>ì±„ì  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<h3>âŒ ìœ íš¨í•˜ì§€ ì•Šì€ API í‚¤</h3><p>í‚¤ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</p>';
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>âŒ ê²€ì¦ ì‹¤íŒ¨</h3><p>${error.message}</p>`;
            }
        }

        // ì„¸ì…˜ì— API í‚¤ ì €ì¥
        function saveKeyToSession() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            sessionStorage.setItem('openrouter_api_key', apiKey);
            alert('âœ… API í‚¤ê°€ ì„¸ì…˜ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ë¸Œë¼ìš°ì €ë¥¼ ë‹«ìœ¼ë©´ ì‚­ì œë©ë‹ˆë‹¤)');
        }

        // AI ì±„ì  ìˆ˜í–‰
        async function performGrading() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const userId = document.getElementById('userId').value;
            const problemId = parseInt(document.getElementById('problemId').value);
            const resultDiv = document.getElementById('gradingResult');

            // ê¶Œí•œ í™•ì¸
            if (!TBSBackend.auth.isAdmin()) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>âŒ ê¶Œí•œ ì˜¤ë¥˜</h3><p>ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>';
                return;
            }

            if (!apiKey) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>âŒ ì…ë ¥ ì˜¤ë¥˜</h3><p>API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>';
                return;
            }

            // ë¡œë”© í‘œì‹œ
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '<h3>â³ AI ì±„ì  ì¤‘...</h3><p>ìµœëŒ€ 60ì´ˆê°€ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';

            try {
                const result = await AIGrading.gradeSubmission(apiKey, userId, problemId);

                // ì„±ê³µ ê²°ê³¼ í‘œì‹œ
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <h3>âœ… ì±„ì  ì™„ë£Œ</h3>
                    <div class="score-display">${result.score}ì </div>
                    <p><strong>ğŸ“ í”¼ë“œë°±:</strong></p>
                    <p style="background: white; padding: 15px; border-radius: 6px; margin: 10px 0;">${result.feedback}</p>
                    <p><strong>ğŸ·ï¸ ì·¨ì•½ì  íƒœê·¸:</strong></p>
                    <div class="tags">
                        ${result.weaknessTags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    ${result.detailedScores ? `
                        <p style="margin-top: 15px;"><strong>ğŸ“Š ì„¸ë¶€ ì ìˆ˜:</strong></p>
                        <ul style="margin-left: 20px;">
                            ${Object.entries(result.detailedScores).map(([key, value]) =>
                                `<li>${key}: ${value}ì </li>`
                            ).join('')}
                        </ul>
                    ` : ''}
                    <p style="margin-top: 15px; font-size: 12px; color: #666;">
                        ì†Œìš” ì‹œê°„: ${result.metadata.elapsedTime}ms |
                        ëª¨ë¸: ${result.metadata.model}
                    </p>
                `;

            } catch (error) {
                handleGradingError(error, resultDiv);
            }
        }

        // ì§ì ‘ ì±„ì  ìˆ˜í–‰
        async function performDirectGrading() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const problemId = parseInt(document.getElementById('directProblemId').value);
            const answer = document.getElementById('directAnswer').value.trim();
            const resultDiv = document.getElementById('directGradingResult');

            if (!apiKey || !answer) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>âŒ ì…ë ¥ ì˜¤ë¥˜</h3><p>API í‚¤ì™€ ë‹µì•ˆì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.</p>';
                return;
            }

            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '<h3>â³ AI ì±„ì  ì¤‘...</h3><p>ë‹µì•ˆì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>';

            try {
                const result = await AIGrading.grade(apiKey, problemId, answer);

                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <h3>âœ… ì±„ì  ì™„ë£Œ</h3>
                    <div class="score-display">${result.score}ì </div>
                    <p><strong>ğŸ“ í”¼ë“œë°±:</strong></p>
                    <p style="background: white; padding: 15px; border-radius: 6px; margin: 10px 0;">${result.feedback}</p>
                    <p><strong>ğŸ·ï¸ ì·¨ì•½ì  íƒœê·¸:</strong></p>
                    <div class="tags">
                        ${result.weaknessTags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <p style="margin-top: 15px; font-size: 12px; color: #666;">
                        âš ï¸ ì´ ê²°ê³¼ëŠ” ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. TBSBackend.admin.saveGrade()ë¡œ ìˆ˜ë™ ì €ì¥í•˜ì„¸ìš”.
                    </p>
                `;

            } catch (error) {
                handleGradingError(error, resultDiv);
            }
        }

        // ì—ëŸ¬ ì²˜ë¦¬
        function handleGradingError(error, resultDiv) {
            let errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            let details = '';

            if (error instanceof AIGrading.errors.AIAPIError) {
                switch (error.status) {
                    case 401:
                        errorMessage = 'API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        details = 'í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ê³  ê²€ì¦ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
                        break;
                    case 429:
                        errorMessage = 'API í˜¸ì¶œ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
                        details = '1ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        break;
                    case 408:
                        errorMessage = 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                        details = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        break;
                    default:
                        errorMessage = `API ì˜¤ë¥˜ (${error.status})`;
                        details = error.message;
                }
            } else if (error instanceof AIGrading.errors.AIParsingError) {
                errorMessage = 'AI ì‘ë‹µ íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                details = error.message;
                console.error('ì›ë³¸ ì‘ë‹µ:', error.rawResponse);
            } else {
                errorMessage = error.message || errorMessage;
            }

            resultDiv.className = 'result error';
            resultDiv.innerHTML = `
                <h3>âŒ ì±„ì  ì‹¤íŒ¨</h3>
                <p><strong>${errorMessage}</strong></p>
                ${details ? `<p>${details}</p>` : ''}
                <p style="margin-top: 10px; font-size: 12px;">
                    ìì„¸í•œ ë‚´ìš©ì€ ê°œë°œì ì½˜ì†”(F12)ì„ í™•ì¸í•˜ì„¸ìš”.
                </p>
            `;

            console.error('[Grading Error]', error);
        }

        // í”„ë¡¬í”„íŠ¸ í™•ì¸
        function showPrompt() {
            const resultDiv = document.getElementById('debugResult');
            const prompt1 = AIGrading.getPrompt(1);
            const prompt2 = AIGrading.getPrompt(2);

            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <h3>ğŸ“‹ ì±„ì  í”„ë¡¬í”„íŠ¸</h3>
                <h4 style="margin-top: 15px;">ë¬¸ì œ 1:</h4>
                <pre style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;">${prompt1.systemPrompt}</pre>
                <h4 style="margin-top: 15px;">ë¬¸ì œ 2:</h4>
                <pre style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;">${prompt2.systemPrompt}</pre>
            `;
        }

        // ì œì¶œ í˜„í™© í™•ì¸
        function showSubmissions() {
            const resultDiv = document.getElementById('debugResult');

            if (!TBSBackend.auth.isAdmin()) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>âŒ ê¶Œí•œ ì˜¤ë¥˜</h3><p>ê´€ë¦¬ìë§Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const submissions = TBSBackend.admin.getAllSubmissions();

            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <h3>ğŸ“„ ì œì¶œ í˜„í™© (ì´ ${submissions.length}ê±´)</h3>
                <pre style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;">${JSON.stringify(submissions, null, 2)}</pre>
            `;
        }

        // ì±„ì  í˜„í™© í™•ì¸
        function showGrades() {
            const resultDiv = document.getElementById('debugResult');

            if (!TBSBackend.auth.isAdmin()) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>âŒ ê¶Œí•œ ì˜¤ë¥˜</h3><p>ê´€ë¦¬ìë§Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const grades = localStorage.getItem('tbs_grades');
            const gradesObj = grades ? JSON.parse(grades) : {};

            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <h3>ğŸ“Š ì±„ì  í˜„í™©</h3>
                <pre style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;">${JSON.stringify(gradesObj, null, 2)}</pre>
            `;
        }

        // Storage ì´ˆê¸°í™”
        function clearStorage() {
            if (!confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì œì¶œ, ì±„ì , ë¡œê·¸ì¸ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤)')) {
                return;
            }

            TBSBackend.reset();
            sessionStorage.clear();

            alert('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
            updateLoginStatus();

            const resultDiv = document.getElementById('debugResult');
            resultDiv.className = 'result success';
            resultDiv.innerHTML = '<h3>âœ… ì´ˆê¸°í™” ì™„ë£Œ</h3><p>ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒì•„ê°”ìŠµë‹ˆë‹¤.</p>';
        }
    </script>
</body>
</html>
